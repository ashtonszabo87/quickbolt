import pytest

from quickbolt.batch_generation import generate_batch

pytestmark = pytest.mark.batch_generation


# using the ';' to denote the start of the path arguments.
url_semi = "https://httpbin.org;/houseId/1b"
url = "https://httpbin.org/houseId/1b"
url_query = "https://httpbin.org/get/houseId/1b?query=value1&query=value2"

body = {"field1": "value1", "field2": 2, "field3": {"field4": "value2"}}


def test_generate_batch_required_args_only():
    batch = generate_batch("get", url_semi)

    expected_batch = [
        {
            "code": "200",
            "description": "good",
            "method": "get",
            "headers": {},
            "url": "https://httpbin.org/houseId/1b",
        },
        {
            "code": "400",
            "description": "invalid",
            "method": "get",
            "headers": {},
            "url": "https://httpbin.org/aaaaaaaaaaaaaaaaaaaaa/1b",
        },
        {
            "code": "400",
            "description": "invalid",
            "method": "get",
            "headers": {},
            "url": "https://httpbin.org/houseId/999aaa",
        },
        {
            "code": "400",
            "description": "invalid",
            "method": "get",
            "headers": {},
            "url": "https://httpbin.org/aaaaaaaaaaaaaaaaaaaaa/999aaa",
        },
        {
            "code": "404",
            "description": "not found",
            "method": "get",
            "headers": {},
            "url": "https://httpbin.org/aaaaaaa/1b",
        },
        {
            "code": "404",
            "description": "not found",
            "method": "get",
            "headers": {},
            "url": "https://httpbin.org/houseId/0a",
        },
        {
            "code": "404",
            "description": "not found",
            "method": "get",
            "headers": {},
            "url": "https://httpbin.org/aaaaaaa/0a",
        },
    ]
    assert batch == expected_batch


def test_generate_batch():
    batch = generate_batch("get", url_semi, headers={"key1": "value1"})

    expected_batch = [
        {
            "code": "200",
            "description": "good",
            "method": "get",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
        },
        {
            "code": "400",
            "description": "invalid",
            "method": "get",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/aaaaaaaaaaaaaaaaaaaaa/1b",
        },
        {
            "code": "400",
            "description": "invalid",
            "method": "get",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/999aaa",
        },
        {
            "code": "400",
            "description": "invalid",
            "method": "get",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/aaaaaaaaaaaaaaaaaaaaa/999aaa",
        },
        {
            "code": "401",
            "description": "not auth",
            "method": "get",
            "headers": {"key1": "aaaaa0"},
            "url": "https://httpbin.org/houseId/1b",
        },
        {
            "code": "404",
            "description": "not found",
            "method": "get",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/aaaaaaa/1b",
        },
        {
            "code": "404",
            "description": "not found",
            "method": "get",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/0a",
        },
        {
            "code": "404",
            "description": "not found",
            "method": "get",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/aaaaaaa/0a",
        },
    ]
    assert batch == expected_batch


def test_generate_batch_description():
    description = "Basic batch"
    batch = generate_batch(
        "get",
        url,
        headers={"key1": "value1", "key22": "value22"},
        description=description,
    )

    expected_batch = [
        {
            "code": "200",
            "description": "Basic batch good",
            "method": "get",
            "headers": {"key1": "value1", "key22": "value22"},
            "url": "https://httpbin.org/houseId/1b",
        },
        {
            "code": "400",
            "description": "Basic batch invalid",
            "method": "get",
            "headers": {"key1": "value1", "key22": "value22"},
            "url": "https://httpbin.org/aaaaaaaaaaaaaaaaaaaaa/1b",
        },
        {
            "code": "400",
            "description": "Basic batch invalid",
            "method": "get",
            "headers": {"key1": "value1", "key22": "value22"},
            "url": "https://httpbin.org/houseId/999aaa",
        },
        {
            "code": "400",
            "description": "Basic batch invalid",
            "method": "get",
            "headers": {"key1": "value1", "key22": "value22"},
            "url": "https://httpbin.org/aaaaaaaaaaaaaaaaaaaaa/999aaa",
        },
        {
            "code": "401",
            "description": "Basic batch not auth",
            "method": "get",
            "headers": {"key1": "aaaaa0", "key22": "value22"},
            "url": "https://httpbin.org/houseId/1b",
        },
        {
            "code": "404",
            "description": "Basic batch not found",
            "method": "get",
            "headers": {"key1": "value1", "key22": "value22"},
            "url": "https://httpbin.org/aaaaaaa/1b",
        },
        {
            "code": "404",
            "description": "Basic batch not found",
            "method": "get",
            "headers": {"key1": "value1", "key22": "value22"},
            "url": "https://httpbin.org/houseId/0a",
        },
        {
            "code": "404",
            "description": "Basic batch not found",
            "method": "get",
            "headers": {"key1": "value1", "key22": "value22"},
            "url": "https://httpbin.org/aaaaaaa/0a",
        },
    ]
    assert batch == expected_batch


def test_generate_batch_bad_header_count():
    batch = generate_batch(
        "get",
        url,
        headers={"key1": "value1", "key2": "value2"},
        bad_header_count=2,
    )

    expected_batch = [
        {
            "code": "200",
            "description": "good",
            "method": "get",
            "headers": {"key1": "value1", "key2": "value2"},
            "url": "https://httpbin.org/houseId/1b",
        },
        {
            "code": "400",
            "description": "invalid",
            "method": "get",
            "headers": {"key1": "value1", "key2": "value2"},
            "url": "https://httpbin.org/aaaaaaaaaaaaaaaaaaaaa/1b",
        },
        {
            "code": "400",
            "description": "invalid",
            "method": "get",
            "headers": {"key1": "value1", "key2": "value2"},
            "url": "https://httpbin.org/houseId/999aaa",
        },
        {
            "code": "400",
            "description": "invalid",
            "method": "get",
            "headers": {"key1": "value1", "key2": "value2"},
            "url": "https://httpbin.org/aaaaaaaaaaaaaaaaaaaaa/999aaa",
        },
        {
            "code": "401",
            "description": "not auth",
            "method": "get",
            "headers": {"key1": "aaaaa0", "key2": "value2"},
            "url": "https://httpbin.org/houseId/1b",
        },
        {
            "code": "401",
            "description": "not auth",
            "method": "get",
            "headers": {"key1": "value1", "key2": "aaaaa0"},
            "url": "https://httpbin.org/houseId/1b",
        },
        {
            "code": "404",
            "description": "not found",
            "method": "get",
            "headers": {"key1": "value1", "key2": "value2"},
            "url": "https://httpbin.org/aaaaaaa/1b",
        },
        {
            "code": "404",
            "description": "not found",
            "method": "get",
            "headers": {"key1": "value1", "key2": "value2"},
            "url": "https://httpbin.org/houseId/0a",
        },
        {
            "code": "404",
            "description": "not found",
            "method": "get",
            "headers": {"key1": "value1", "key2": "value2"},
            "url": "https://httpbin.org/aaaaaaa/0a",
        },
    ]
    assert batch == expected_batch


def test_generate_batch_include_query_params():
    batch = generate_batch("get", url_query, headers={"key1": "value1"})

    expected_batch = [
        {
            "code": "200",
            "description": "good",
            "method": "get",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/get/houseId/1b?query=value1&query=value2",
        },
        {
            "code": "400",
            "description": "invalid",
            "method": "get",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/aaaaaaaaa/houseId/1b?query=value1&query=value2",
        },
        {
            "code": "400",
            "description": "invalid",
            "method": "get",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/get/aaaaaaaaaaaaaaaaaaaaa/1b?query=value1&query=value2",
        },
        {
            "code": "400",
            "description": "invalid",
            "method": "get",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/get/houseId/999aaa?query=value1&query=value2",
        },
        {
            "code": "400",
            "description": "invalid",
            "method": "get",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/get/houseId/1b?query=aaaaaaaaaaaaaaa999&query=value2",
        },
        {
            "code": "400",
            "description": "invalid",
            "method": "get",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/get/houseId/1b?query=value1&query=aaaaaaaaaaaaaaa999",
        },
        {
            "code": "400",
            "description": "invalid",
            "method": "get",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/aaaaaaaaa/aaaaaaaaaaaaaaaaaaaaa/999aaa?query=aaaaaaaaaaaaaaa999&query=aaaaaaaaaaaaaaa999",
        },
        {
            "code": "401",
            "description": "not auth",
            "method": "get",
            "headers": {"key1": "aaaaa0"},
            "url": "https://httpbin.org/get/houseId/1b?query=value1&query=value2",
        },
        {
            "code": "404",
            "description": "not found",
            "method": "get",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/aaa/houseId/1b?query=value1&query=value2",
        },
        {
            "code": "404",
            "description": "not found",
            "method": "get",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/get/aaaaaaa/1b?query=value1&query=value2",
        },
        {
            "code": "404",
            "description": "not found",
            "method": "get",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/get/houseId/0a?query=value1&query=value2",
        },
        {
            "code": "404",
            "description": "not found",
            "method": "get",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/get/houseId/1b?query=aaaaa0&query=value2",
        },
        {
            "code": "404",
            "description": "not found",
            "method": "get",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/get/houseId/1b?query=value1&query=aaaaa0",
        },
        {
            "code": "404",
            "description": "not found",
            "method": "get",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/aaa/aaaaaaa/0a?query=aaaaa0&query=aaaaa0",
        },
    ]
    assert batch == expected_batch


def test_generate_batch_include_not_including_query_params():
    batch = generate_batch(
        "get", url_query, headers={"key1": "value1"}, corrupt_query_params=False
    )

    expected_batch = [
        {
            "code": "200",
            "description": "good",
            "method": "get",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/get/houseId/1b?query=value1&query=value2",
        },
        {
            "code": "400",
            "description": "invalid",
            "method": "get",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/aaaaaaaaa/houseId/1b?query=value1&query=value2",
        },
        {
            "code": "400",
            "description": "invalid",
            "method": "get",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/get/aaaaaaaaaaaaaaaaaaaaa/1b?query=value1&query=value2",
        },
        {
            "code": "400",
            "description": "invalid",
            "method": "get",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/get/houseId/999aaa?query=value1&query=value2",
        },
        {
            "code": "400",
            "description": "invalid",
            "method": "get",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/aaaaaaaaa/aaaaaaaaaaaaaaaaaaaaa/999aaa?query=value1&query=value2",
        },
        {
            "code": "401",
            "description": "not auth",
            "method": "get",
            "headers": {"key1": "aaaaa0"},
            "url": "https://httpbin.org/get/houseId/1b?query=value1&query=value2",
        },
        {
            "code": "404",
            "description": "not found",
            "method": "get",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/aaa/houseId/1b?query=value1&query=value2",
        },
        {
            "code": "404",
            "description": "not found",
            "method": "get",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/get/aaaaaaa/1b?query=value1&query=value2",
        },
        {
            "code": "404",
            "description": "not found",
            "method": "get",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/get/houseId/0a?query=value1&query=value2",
        },
        {
            "code": "404",
            "description": "not found",
            "method": "get",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/aaa/aaaaaaa/0a?query=value1&query=value2",
        },
    ]
    assert batch == expected_batch


def test_generate_batch_json_body():
    batch = generate_batch("post", url, headers={"key1": "value1"}, json=body)

    expected_batch = [
        {
            "code": "201",
            "description": "good",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {"field1": "value1", "field2": 2, "field3": {"field4": "value2"}},
        },
        {
            "code": "400",
            "description": "invalid",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/aaaaaaaaaaaaaaaaaaaaa/1b",
            "json": {"field1": "value1", "field2": 2, "field3": {"field4": "value2"}},
        },
        {
            "code": "400",
            "description": "invalid",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/999aaa",
            "json": {"field1": "value1", "field2": 2, "field3": {"field4": "value2"}},
        },
        {
            "code": "400",
            "description": "invalid",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/aaaaaaaaaaaaaaaaaaaaa/999aaa",
            "json": {"field1": "value1", "field2": 2, "field3": {"field4": "value2"}},
        },
        {
            "code": "400",
            "description": "invalid",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {
                "field1": "aaaaaaaaaaaaaaa999",
                "field2": 2,
                "field3": {"field4": "value2"},
            },
        },
        {
            "code": "400",
            "description": "invalid",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {"field1": "value1", "field2": 999, "field3": {"field4": "value2"}},
        },
        {
            "code": "400",
            "description": "invalid",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {
                "field1": "value1",
                "field2": 2,
                "field3": {"field4": "aaaaaaaaaaaaaaa999"},
            },
        },
        {
            "code": "400",
            "description": "invalid",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {
                "field1": "aaaaaaaaaaaaaaa999",
                "field2": 999,
                "field3": {"field4": "aaaaaaaaaaaaaaa999"},
            },
        },
        {
            "code": "401",
            "description": "not auth",
            "method": "post",
            "headers": {"key1": "aaaaa0"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {"field1": "value1", "field2": 2, "field3": {"field4": "value2"}},
        },
        {
            "code": "404",
            "description": "not found",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/aaaaaaa/1b",
            "json": {"field1": "value1", "field2": 2, "field3": {"field4": "value2"}},
        },
        {
            "code": "404",
            "description": "not found",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/0a",
            "json": {"field1": "value1", "field2": 2, "field3": {"field4": "value2"}},
        },
        {
            "code": "404",
            "description": "not found",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/aaaaaaa/0a",
            "json": {"field1": "value1", "field2": 2, "field3": {"field4": "value2"}},
        },
        {
            "code": "404",
            "description": "not found",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {"field1": "aaaaa0", "field2": 2, "field3": {"field4": "value2"}},
        },
        {
            "code": "404",
            "description": "not found",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {"field1": "value1", "field2": 0, "field3": {"field4": "value2"}},
        },
        {
            "code": "404",
            "description": "not found",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {"field1": "value1", "field2": 2, "field3": {"field4": "aaaaa0"}},
        },
        {
            "code": "404",
            "description": "not found",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {"field1": "aaaaa0", "field2": 0, "field3": {"field4": "aaaaa0"}},
        },
    ]
    assert batch == expected_batch


def test_generate_batch_json_body_min_false():
    batch = generate_batch(
        "post",
        url,
        headers={"key1": "value1"},
        json={**body, **{"body2": body}},
        min=False,
    )

    expected_batch = [
        {
            "code": "201",
            "description": "good",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {
                "field1": "value1",
                "field2": 2,
                "field3": {"field4": "value2"},
                "body2": {
                    "field1": "value1",
                    "field2": 2,
                    "field3": {"field4": "value2"},
                },
            },
        },
        {
            "code": "400",
            "description": "invalid",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/aaaaaaaaaaaaaaaaaaaaa/1b",
            "json": {
                "field1": "value1",
                "field2": 2,
                "field3": {"field4": "value2"},
                "body2": {
                    "field1": "value1",
                    "field2": 2,
                    "field3": {"field4": "value2"},
                },
            },
        },
        {
            "code": "400",
            "description": "invalid",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/999aaa",
            "json": {
                "field1": "value1",
                "field2": 2,
                "field3": {"field4": "value2"},
                "body2": {
                    "field1": "value1",
                    "field2": 2,
                    "field3": {"field4": "value2"},
                },
            },
        },
        {
            "code": "400",
            "description": "invalid",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/aaaaaaaaaaaaaaaaaaaaa/999aaa",
            "json": {
                "field1": "value1",
                "field2": 2,
                "field3": {"field4": "value2"},
                "body2": {
                    "field1": "value1",
                    "field2": 2,
                    "field3": {"field4": "value2"},
                },
            },
        },
        {
            "code": "400",
            "description": "invalid",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {
                "field1": "aaaaaaaaaaaaaaa999",
                "field2": 999,
                "field3": {"field4": "value2"},
                "body2": {
                    "field1": "value1",
                    "field2": 2,
                    "field3": {"field4": "value2"},
                },
            },
        },
        {
            "code": "400",
            "description": "invalid",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {
                "field1": "aaaaaaaaaaaaaaa999",
                "field2": 2,
                "field3": {"field4": "aaaaaaaaaaaaaaa999"},
                "body2": {
                    "field1": "value1",
                    "field2": 2,
                    "field3": {"field4": "value2"},
                },
            },
        },
        {
            "code": "400",
            "description": "invalid",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {
                "field1": "aaaaaaaaaaaaaaa999",
                "field2": 2,
                "field3": {"field4": "value2"},
                "body2": {
                    "field1": "aaaaaaaaaaaaaaa999",
                    "field2": 2,
                    "field3": {"field4": "value2"},
                },
            },
        },
        {
            "code": "400",
            "description": "invalid",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {
                "field1": "aaaaaaaaaaaaaaa999",
                "field2": 2,
                "field3": {"field4": "value2"},
                "body2": {
                    "field1": "value1",
                    "field2": 999,
                    "field3": {"field4": "value2"},
                },
            },
        },
        {
            "code": "400",
            "description": "invalid",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {
                "field1": "aaaaaaaaaaaaaaa999",
                "field2": 2,
                "field3": {"field4": "value2"},
                "body2": {
                    "field1": "value1",
                    "field2": 2,
                    "field3": {"field4": "aaaaaaaaaaaaaaa999"},
                },
            },
        },
        {
            "code": "400",
            "description": "invalid",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {
                "field1": "value1",
                "field2": 999,
                "field3": {"field4": "aaaaaaaaaaaaaaa999"},
                "body2": {
                    "field1": "value1",
                    "field2": 2,
                    "field3": {"field4": "value2"},
                },
            },
        },
        {
            "code": "400",
            "description": "invalid",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {
                "field1": "value1",
                "field2": 999,
                "field3": {"field4": "value2"},
                "body2": {
                    "field1": "aaaaaaaaaaaaaaa999",
                    "field2": 2,
                    "field3": {"field4": "value2"},
                },
            },
        },
        {
            "code": "400",
            "description": "invalid",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {
                "field1": "value1",
                "field2": 999,
                "field3": {"field4": "value2"},
                "body2": {
                    "field1": "value1",
                    "field2": 999,
                    "field3": {"field4": "value2"},
                },
            },
        },
        {
            "code": "400",
            "description": "invalid",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {
                "field1": "value1",
                "field2": 999,
                "field3": {"field4": "value2"},
                "body2": {
                    "field1": "value1",
                    "field2": 2,
                    "field3": {"field4": "aaaaaaaaaaaaaaa999"},
                },
            },
        },
        {
            "code": "400",
            "description": "invalid",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {
                "field1": "value1",
                "field2": 2,
                "field3": {"field4": "aaaaaaaaaaaaaaa999"},
                "body2": {
                    "field1": "aaaaaaaaaaaaaaa999",
                    "field2": 2,
                    "field3": {"field4": "value2"},
                },
            },
        },
        {
            "code": "400",
            "description": "invalid",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {
                "field1": "value1",
                "field2": 2,
                "field3": {"field4": "aaaaaaaaaaaaaaa999"},
                "body2": {
                    "field1": "value1",
                    "field2": 999,
                    "field3": {"field4": "value2"},
                },
            },
        },
        {
            "code": "400",
            "description": "invalid",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {
                "field1": "value1",
                "field2": 2,
                "field3": {"field4": "aaaaaaaaaaaaaaa999"},
                "body2": {
                    "field1": "value1",
                    "field2": 2,
                    "field3": {"field4": "aaaaaaaaaaaaaaa999"},
                },
            },
        },
        {
            "code": "400",
            "description": "invalid",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {
                "field1": "value1",
                "field2": 2,
                "field3": {"field4": "value2"},
                "body2": {
                    "field1": "aaaaaaaaaaaaaaa999",
                    "field2": 999,
                    "field3": {"field4": "value2"},
                },
            },
        },
        {
            "code": "400",
            "description": "invalid",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {
                "field1": "value1",
                "field2": 2,
                "field3": {"field4": "value2"},
                "body2": {
                    "field1": "aaaaaaaaaaaaaaa999",
                    "field2": 2,
                    "field3": {"field4": "aaaaaaaaaaaaaaa999"},
                },
            },
        },
        {
            "code": "400",
            "description": "invalid",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {
                "field1": "value1",
                "field2": 2,
                "field3": {"field4": "value2"},
                "body2": {
                    "field1": "value1",
                    "field2": 999,
                    "field3": {"field4": "aaaaaaaaaaaaaaa999"},
                },
            },
        },
        {
            "code": "400",
            "description": "invalid",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {
                "field1": "aaaaaaaaaaaaaaa999",
                "field2": 999,
                "field3": {"field4": "aaaaaaaaaaaaaaa999"},
                "body2": {
                    "field1": "aaaaaaaaaaaaaaa999",
                    "field2": 999,
                    "field3": {"field4": "aaaaaaaaaaaaaaa999"},
                },
            },
        },
        {
            "code": "401",
            "description": "not auth",
            "method": "post",
            "headers": {"key1": "aaaaa0"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {
                "field1": "value1",
                "field2": 2,
                "field3": {"field4": "value2"},
                "body2": {
                    "field1": "value1",
                    "field2": 2,
                    "field3": {"field4": "value2"},
                },
            },
        },
        {
            "code": "404",
            "description": "not found",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/aaaaaaa/1b",
            "json": {
                "field1": "value1",
                "field2": 2,
                "field3": {"field4": "value2"},
                "body2": {
                    "field1": "value1",
                    "field2": 2,
                    "field3": {"field4": "value2"},
                },
            },
        },
        {
            "code": "404",
            "description": "not found",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/0a",
            "json": {
                "field1": "value1",
                "field2": 2,
                "field3": {"field4": "value2"},
                "body2": {
                    "field1": "value1",
                    "field2": 2,
                    "field3": {"field4": "value2"},
                },
            },
        },
        {
            "code": "404",
            "description": "not found",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/aaaaaaa/0a",
            "json": {
                "field1": "value1",
                "field2": 2,
                "field3": {"field4": "value2"},
                "body2": {
                    "field1": "value1",
                    "field2": 2,
                    "field3": {"field4": "value2"},
                },
            },
        },
        {
            "code": "404",
            "description": "not found",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {
                "field1": "aaaaa0",
                "field2": 0,
                "field3": {"field4": "value2"},
                "body2": {
                    "field1": "value1",
                    "field2": 2,
                    "field3": {"field4": "value2"},
                },
            },
        },
        {
            "code": "404",
            "description": "not found",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {
                "field1": "aaaaa0",
                "field2": 2,
                "field3": {"field4": "aaaaa0"},
                "body2": {
                    "field1": "value1",
                    "field2": 2,
                    "field3": {"field4": "value2"},
                },
            },
        },
        {
            "code": "404",
            "description": "not found",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {
                "field1": "aaaaa0",
                "field2": 2,
                "field3": {"field4": "value2"},
                "body2": {
                    "field1": "aaaaa0",
                    "field2": 2,
                    "field3": {"field4": "value2"},
                },
            },
        },
        {
            "code": "404",
            "description": "not found",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {
                "field1": "aaaaa0",
                "field2": 2,
                "field3": {"field4": "value2"},
                "body2": {
                    "field1": "value1",
                    "field2": 0,
                    "field3": {"field4": "value2"},
                },
            },
        },
        {
            "code": "404",
            "description": "not found",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {
                "field1": "aaaaa0",
                "field2": 2,
                "field3": {"field4": "value2"},
                "body2": {
                    "field1": "value1",
                    "field2": 2,
                    "field3": {"field4": "aaaaa0"},
                },
            },
        },
        {
            "code": "404",
            "description": "not found",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {
                "field1": "value1",
                "field2": 0,
                "field3": {"field4": "aaaaa0"},
                "body2": {
                    "field1": "value1",
                    "field2": 2,
                    "field3": {"field4": "value2"},
                },
            },
        },
        {
            "code": "404",
            "description": "not found",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {
                "field1": "value1",
                "field2": 0,
                "field3": {"field4": "value2"},
                "body2": {
                    "field1": "aaaaa0",
                    "field2": 2,
                    "field3": {"field4": "value2"},
                },
            },
        },
        {
            "code": "404",
            "description": "not found",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {
                "field1": "value1",
                "field2": 0,
                "field3": {"field4": "value2"},
                "body2": {
                    "field1": "value1",
                    "field2": 0,
                    "field3": {"field4": "value2"},
                },
            },
        },
        {
            "code": "404",
            "description": "not found",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {
                "field1": "value1",
                "field2": 0,
                "field3": {"field4": "value2"},
                "body2": {
                    "field1": "value1",
                    "field2": 2,
                    "field3": {"field4": "aaaaa0"},
                },
            },
        },
        {
            "code": "404",
            "description": "not found",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {
                "field1": "value1",
                "field2": 2,
                "field3": {"field4": "aaaaa0"},
                "body2": {
                    "field1": "aaaaa0",
                    "field2": 2,
                    "field3": {"field4": "value2"},
                },
            },
        },
        {
            "code": "404",
            "description": "not found",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {
                "field1": "value1",
                "field2": 2,
                "field3": {"field4": "aaaaa0"},
                "body2": {
                    "field1": "value1",
                    "field2": 0,
                    "field3": {"field4": "value2"},
                },
            },
        },
        {
            "code": "404",
            "description": "not found",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {
                "field1": "value1",
                "field2": 2,
                "field3": {"field4": "aaaaa0"},
                "body2": {
                    "field1": "value1",
                    "field2": 2,
                    "field3": {"field4": "aaaaa0"},
                },
            },
        },
        {
            "code": "404",
            "description": "not found",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {
                "field1": "value1",
                "field2": 2,
                "field3": {"field4": "value2"},
                "body2": {
                    "field1": "aaaaa0",
                    "field2": 0,
                    "field3": {"field4": "value2"},
                },
            },
        },
        {
            "code": "404",
            "description": "not found",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {
                "field1": "value1",
                "field2": 2,
                "field3": {"field4": "value2"},
                "body2": {
                    "field1": "aaaaa0",
                    "field2": 2,
                    "field3": {"field4": "aaaaa0"},
                },
            },
        },
        {
            "code": "404",
            "description": "not found",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {
                "field1": "value1",
                "field2": 2,
                "field3": {"field4": "value2"},
                "body2": {
                    "field1": "value1",
                    "field2": 0,
                    "field3": {"field4": "aaaaa0"},
                },
            },
        },
        {
            "code": "404",
            "description": "not found",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {
                "field1": "aaaaa0",
                "field2": 0,
                "field3": {"field4": "aaaaa0"},
                "body2": {
                    "field1": "aaaaa0",
                    "field2": 0,
                    "field3": {"field4": "aaaaa0"},
                },
            },
        },
    ]
    assert batch == expected_batch


def test_generate_batch_data_body():
    batch = generate_batch("post", "url", headers={"key1": "value1"}, data=body)

    expected_batch = [
        {
            "code": "201",
            "description": "good",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "url",
            "data": {"field1": "value1", "field2": 2, "field3": {"field4": "value2"}},
        },
        {
            "code": "400",
            "description": "invalid",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "/aaaaaaaaa",
            "data": {"field1": "value1", "field2": 2, "field3": {"field4": "value2"}},
        },
        {
            "code": "400",
            "description": "invalid",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "/url",
            "data": {"field1": "value1", "field2": 2, "field3": {"field4": "value2"}},
        },
        {
            "code": "400",
            "description": "invalid",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "url",
            "data": {
                "field1": "aaaaaaaaaaaaaaa999",
                "field2": 2,
                "field3": {"field4": "value2"},
            },
        },
        {
            "code": "400",
            "description": "invalid",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "url",
            "data": {"field1": "value1", "field2": 999, "field3": {"field4": "value2"}},
        },
        {
            "code": "400",
            "description": "invalid",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "url",
            "data": {
                "field1": "value1",
                "field2": 2,
                "field3": {"field4": "aaaaaaaaaaaaaaa999"},
            },
        },
        {
            "code": "400",
            "description": "invalid",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "url",
            "data": {
                "field1": "aaaaaaaaaaaaaaa999",
                "field2": 999,
                "field3": {"field4": "aaaaaaaaaaaaaaa999"},
            },
        },
        {
            "code": "401",
            "description": "not auth",
            "method": "post",
            "headers": {"key1": "aaaaa0"},
            "url": "url",
            "data": {"field1": "value1", "field2": 2, "field3": {"field4": "value2"}},
        },
        {
            "code": "404",
            "description": "not found",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "/aaa",
            "data": {"field1": "value1", "field2": 2, "field3": {"field4": "value2"}},
        },
        {
            "code": "404",
            "description": "not found",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "/url",
            "data": {"field1": "value1", "field2": 2, "field3": {"field4": "value2"}},
        },
        {
            "code": "404",
            "description": "not found",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "url",
            "data": {"field1": "aaaaa0", "field2": 2, "field3": {"field4": "value2"}},
        },
        {
            "code": "404",
            "description": "not found",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "url",
            "data": {"field1": "value1", "field2": 0, "field3": {"field4": "value2"}},
        },
        {
            "code": "404",
            "description": "not found",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "url",
            "data": {"field1": "value1", "field2": 2, "field3": {"field4": "aaaaa0"}},
        },
        {
            "code": "404",
            "description": "not found",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "url",
            "data": {"field1": "aaaaa0", "field2": 0, "field3": {"field4": "aaaaa0"}},
        },
    ]
    assert batch == expected_batch


def test_generate_batch_body_and_unsafe_json_bodies():
    batch = generate_batch(
        "post",
        url,
        headers={"key1": "value1"},
        json=body,
        unsafe_bodies=True,
    )

    expected_batch = [
        {
            "code": "201",
            "description": "good",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {"field1": "value1", "field2": 2, "field3": {"field4": "value2"}},
        },
        {
            "code": "400",
            "description": "invalid",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/aaaaaaaaaaaaaaaaaaaaa/1b",
            "json": {"field1": "value1", "field2": 2, "field3": {"field4": "value2"}},
        },
        {
            "code": "400",
            "description": "invalid",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/999aaa",
            "json": {"field1": "value1", "field2": 2, "field3": {"field4": "value2"}},
        },
        {
            "code": "400",
            "description": "invalid",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/aaaaaaaaaaaaaaaaaaaaa/999aaa",
            "json": {"field1": "value1", "field2": 2, "field3": {"field4": "value2"}},
        },
        {
            "code": "400",
            "description": "invalid",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {
                "field1": "aaaaaaaaaaaaaaa999",
                "field2": 2,
                "field3": {"field4": "value2"},
            },
        },
        {
            "code": "400",
            "description": "invalid",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {"field1": "value1", "field2": 999, "field3": {"field4": "value2"}},
        },
        {
            "code": "400",
            "description": "invalid",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {
                "field1": "value1",
                "field2": 2,
                "field3": {"field4": "aaaaaaaaaaaaaaa999"},
            },
        },
        {
            "code": "400",
            "description": "invalid",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {
                "field1": "aaaaaaaaaaaaaaa999",
                "field2": 999,
                "field3": {"field4": "aaaaaaaaaaaaaaa999"},
            },
        },
        {
            "code": "401",
            "description": "not auth",
            "method": "post",
            "headers": {"key1": "aaaaa0"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {"field1": "value1", "field2": 2, "field3": {"field4": "value2"}},
        },
        {
            "code": "404",
            "description": "not found",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/aaaaaaa/1b",
            "json": {"field1": "value1", "field2": 2, "field3": {"field4": "value2"}},
        },
        {
            "code": "404",
            "description": "not found",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/0a",
            "json": {"field1": "value1", "field2": 2, "field3": {"field4": "value2"}},
        },
        {
            "code": "404",
            "description": "not found",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/aaaaaaa/0a",
            "json": {"field1": "value1", "field2": 2, "field3": {"field4": "value2"}},
        },
        {
            "code": "404",
            "description": "not found",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {"field1": "aaaaa0", "field2": 2, "field3": {"field4": "value2"}},
        },
        {
            "code": "404",
            "description": "not found",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {"field1": "value1", "field2": 0, "field3": {"field4": "value2"}},
        },
        {
            "code": "404",
            "description": "not found",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {"field1": "value1", "field2": 2, "field3": {"field4": "aaaaa0"}},
        },
        {
            "code": "404",
            "description": "not found",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {"field1": "aaaaa0", "field2": 0, "field3": {"field4": "aaaaa0"}},
        },
        {
            "code": "???",
            "description": "unsafe bodies",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {
                "field1": "value1  '--",
                "field2": "2  '--",
                "field3": "{'field4': 'value2'}  '--",
            },
        },
        {
            "code": "???",
            "description": "unsafe bodies",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {
                "field1": "value1 '+OR+1=1--",
                "field2": "2 '+OR+1=1--",
                "field3": "{'field4': 'value2'} '+OR+1=1--",
            },
        },
        {
            "code": "???",
            "description": "unsafe bodies",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {
                "field1": "value1 SELECT version() --",
                "field2": "2 SELECT version() --",
                "field3": "{'field4': 'value2'} SELECT version() --",
            },
        },
        {
            "code": "???",
            "description": "unsafe bodies",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {
                "field1": "value1  '--",
                "field2": "2  '--",
                "field3": "{'field4': 'value2'}  '--",
            },
        },
        {
            "code": "???",
            "description": "unsafe bodies",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {
                "field1": "value1 '+OR+1=1--",
                "field2": "2 '+OR+1=1--",
                "field3": "{'field4': 'value2'} '+OR+1=1--",
            },
        },
        {
            "code": "???",
            "description": "unsafe bodies",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {
                "field1": "value1 select database_to_xml(true,true,'');",
                "field2": "2 select database_to_xml(true,true,'');",
                "field3": "{'field4': 'value2'} select database_to_xml(true,true,'');",
            },
        },
        {
            "code": "???",
            "description": "unsafe bodies",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {
                "field1": "value1  '--",
                "field2": "2  '--",
                "field3": "{'field4': 'value2'}  '--",
            },
        },
        {
            "code": "???",
            "description": "unsafe bodies",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {
                "field1": "value1 '+OR+1=1--",
                "field2": "2 '+OR+1=1--",
                "field3": "{'field4': 'value2'} '+OR+1=1--",
            },
        },
        {
            "code": "???",
            "description": "unsafe bodies",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {
                "field1": "value1 UNION SELECT * FROM information_schema.tables --",
                "field2": "2 UNION SELECT * FROM information_schema.tables --",
                "field3": "{'field4': 'value2'} UNION SELECT * FROM information_schema.tables --",
            },
        },
        {
            "code": "???",
            "description": "unsafe bodies",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {
                "field1": "value1  '--",
                "field2": "2  '--",
                "field3": "{'field4': 'value2'}  '--",
            },
        },
        {
            "code": "???",
            "description": "unsafe bodies",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {
                "field1": "value1 ' and substr(version(),1,10) = 'PostgreSQL' and '1  -> OK",
                "field2": "2 ' and substr(version(),1,10) = 'PostgreSQL' and '1  -> OK",
                "field3": "{'field4': 'value2'} ' and substr(version(),1,10) = 'PostgreSQL' and '1  -> OK",
            },
        },
        {
            "code": "???",
            "description": "unsafe bodies",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {
                "field1": "value1 SELECT version() --",
                "field2": "2 SELECT version() --",
                "field3": "{'field4': 'value2'} SELECT version() --",
            },
        },
        {
            "code": "???",
            "description": "unsafe bodies",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {
                "field1": "value1  '--",
                "field2": "2  '--",
                "field3": "{'field4': 'value2'}  '--",
            },
        },
        {
            "code": "???",
            "description": "unsafe bodies",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {
                "field1": "value1 ' and substr(version(),1,10) = 'PostgreSQL' and '1  -> OK",
                "field2": "2 ' and substr(version(),1,10) = 'PostgreSQL' and '1  -> OK",
                "field3": "{'field4': 'value2'} ' and substr(version(),1,10) = 'PostgreSQL' and '1  -> OK",
            },
        },
        {
            "code": "???",
            "description": "unsafe bodies",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {
                "field1": "value1 select database_to_xml(true,true,'');",
                "field2": "2 select database_to_xml(true,true,'');",
                "field3": "{'field4': 'value2'} select database_to_xml(true,true,'');",
            },
        },
        {
            "code": "???",
            "description": "unsafe bodies",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {
                "field1": "value1  '--",
                "field2": "2  '--",
                "field3": "{'field4': 'value2'}  '--",
            },
        },
        {
            "code": "???",
            "description": "unsafe bodies",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {
                "field1": "value1 ' and substr(version(),1,10) = 'PostgreSQL' and '1  -> OK",
                "field2": "2 ' and substr(version(),1,10) = 'PostgreSQL' and '1  -> OK",
                "field3": "{'field4': 'value2'} ' and substr(version(),1,10) = 'PostgreSQL' and '1  -> OK",
            },
        },
        {
            "code": "???",
            "description": "unsafe bodies",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {
                "field1": "value1 UNION SELECT * FROM information_schema.tables --",
                "field2": "2 UNION SELECT * FROM information_schema.tables --",
                "field3": "{'field4': 'value2'} UNION SELECT * FROM information_schema.tables --",
            },
        },
        {
            "code": "???",
            "description": "unsafe bodies",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {
                "field1": "value1  '--",
                "field2": "2  '--",
                "field3": "{'field4': 'value2'}  '--",
            },
        },
        {
            "code": "???",
            "description": "unsafe bodies",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {
                "field1": "value1 SELECT version() --",
                "field2": "2 SELECT version() --",
                "field3": "{'field4': 'value2'} SELECT version() --",
            },
        },
        {
            "code": "???",
            "description": "unsafe bodies",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {
                "field1": "value1 select database_to_xml(true,true,'');",
                "field2": "2 select database_to_xml(true,true,'');",
                "field3": "{'field4': 'value2'} select database_to_xml(true,true,'');",
            },
        },
        {
            "code": "???",
            "description": "unsafe bodies",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {
                "field1": "value1  '--",
                "field2": "2  '--",
                "field3": "{'field4': 'value2'}  '--",
            },
        },
        {
            "code": "???",
            "description": "unsafe bodies",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {
                "field1": "value1 SELECT version() --",
                "field2": "2 SELECT version() --",
                "field3": "{'field4': 'value2'} SELECT version() --",
            },
        },
        {
            "code": "???",
            "description": "unsafe bodies",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {
                "field1": "value1 UNION SELECT * FROM information_schema.tables --",
                "field2": "2 UNION SELECT * FROM information_schema.tables --",
                "field3": "{'field4': 'value2'} UNION SELECT * FROM information_schema.tables --",
            },
        },
        {
            "code": "???",
            "description": "unsafe bodies",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {
                "field1": "value1  '--",
                "field2": "2  '--",
                "field3": "{'field4': 'value2'}  '--",
            },
        },
        {
            "code": "???",
            "description": "unsafe bodies",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {
                "field1": "value1 select database_to_xml(true,true,'');",
                "field2": "2 select database_to_xml(true,true,'');",
                "field3": "{'field4': 'value2'} select database_to_xml(true,true,'');",
            },
        },
        {
            "code": "???",
            "description": "unsafe bodies",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {
                "field1": "value1 UNION SELECT * FROM information_schema.tables --",
                "field2": "2 UNION SELECT * FROM information_schema.tables --",
                "field3": "{'field4': 'value2'} UNION SELECT * FROM information_schema.tables --",
            },
        },
        {
            "code": "???",
            "description": "unsafe bodies",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {
                "field1": "value1 '+OR+1=1--",
                "field2": "2 '+OR+1=1--",
                "field3": "{'field4': 'value2'} '+OR+1=1--",
            },
        },
        {
            "code": "???",
            "description": "unsafe bodies",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {
                "field1": "value1 SELECT version() --",
                "field2": "2 SELECT version() --",
                "field3": "{'field4': 'value2'} SELECT version() --",
            },
        },
        {
            "code": "???",
            "description": "unsafe bodies",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {
                "field1": "value1 select database_to_xml(true,true,'');",
                "field2": "2 select database_to_xml(true,true,'');",
                "field3": "{'field4': 'value2'} select database_to_xml(true,true,'');",
            },
        },
        {
            "code": "???",
            "description": "unsafe bodies",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {
                "field1": "value1 '+OR+1=1--",
                "field2": "2 '+OR+1=1--",
                "field3": "{'field4': 'value2'} '+OR+1=1--",
            },
        },
        {
            "code": "???",
            "description": "unsafe bodies",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {
                "field1": "value1 SELECT version() --",
                "field2": "2 SELECT version() --",
                "field3": "{'field4': 'value2'} SELECT version() --",
            },
        },
        {
            "code": "???",
            "description": "unsafe bodies",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {
                "field1": "value1 UNION SELECT * FROM information_schema.tables --",
                "field2": "2 UNION SELECT * FROM information_schema.tables --",
                "field3": "{'field4': 'value2'} UNION SELECT * FROM information_schema.tables --",
            },
        },
        {
            "code": "???",
            "description": "unsafe bodies",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {
                "field1": "value1 '+OR+1=1--",
                "field2": "2 '+OR+1=1--",
                "field3": "{'field4': 'value2'} '+OR+1=1--",
            },
        },
        {
            "code": "???",
            "description": "unsafe bodies",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {
                "field1": "value1 select database_to_xml(true,true,'');",
                "field2": "2 select database_to_xml(true,true,'');",
                "field3": "{'field4': 'value2'} select database_to_xml(true,true,'');",
            },
        },
        {
            "code": "???",
            "description": "unsafe bodies",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {
                "field1": "value1 UNION SELECT * FROM information_schema.tables --",
                "field2": "2 UNION SELECT * FROM information_schema.tables --",
                "field3": "{'field4': 'value2'} UNION SELECT * FROM information_schema.tables --",
            },
        },
        {
            "code": "???",
            "description": "unsafe bodies",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {
                "field1": "value1 ' and substr(version(),1,10) = 'PostgreSQL' and '1  -> OK",
                "field2": "2 ' and substr(version(),1,10) = 'PostgreSQL' and '1  -> OK",
                "field3": "{'field4': 'value2'} ' and substr(version(),1,10) = 'PostgreSQL' and '1  -> OK",
            },
        },
        {
            "code": "???",
            "description": "unsafe bodies",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {
                "field1": "value1 SELECT version() --",
                "field2": "2 SELECT version() --",
                "field3": "{'field4': 'value2'} SELECT version() --",
            },
        },
        {
            "code": "???",
            "description": "unsafe bodies",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {
                "field1": "value1 select database_to_xml(true,true,'');",
                "field2": "2 select database_to_xml(true,true,'');",
                "field3": "{'field4': 'value2'} select database_to_xml(true,true,'');",
            },
        },
        {
            "code": "???",
            "description": "unsafe bodies",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {
                "field1": "value1 ' and substr(version(),1,10) = 'PostgreSQL' and '1  -> OK",
                "field2": "2 ' and substr(version(),1,10) = 'PostgreSQL' and '1  -> OK",
                "field3": "{'field4': 'value2'} ' and substr(version(),1,10) = 'PostgreSQL' and '1  -> OK",
            },
        },
        {
            "code": "???",
            "description": "unsafe bodies",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {
                "field1": "value1 SELECT version() --",
                "field2": "2 SELECT version() --",
                "field3": "{'field4': 'value2'} SELECT version() --",
            },
        },
        {
            "code": "???",
            "description": "unsafe bodies",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {
                "field1": "value1 UNION SELECT * FROM information_schema.tables --",
                "field2": "2 UNION SELECT * FROM information_schema.tables --",
                "field3": "{'field4': 'value2'} UNION SELECT * FROM information_schema.tables --",
            },
        },
        {
            "code": "???",
            "description": "unsafe bodies",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {
                "field1": "value1 ' and substr(version(),1,10) = 'PostgreSQL' and '1  -> OK",
                "field2": "2 ' and substr(version(),1,10) = 'PostgreSQL' and '1  -> OK",
                "field3": "{'field4': 'value2'} ' and substr(version(),1,10) = 'PostgreSQL' and '1  -> OK",
            },
        },
        {
            "code": "???",
            "description": "unsafe bodies",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {
                "field1": "value1 select database_to_xml(true,true,'');",
                "field2": "2 select database_to_xml(true,true,'');",
                "field3": "{'field4': 'value2'} select database_to_xml(true,true,'');",
            },
        },
        {
            "code": "???",
            "description": "unsafe bodies",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {
                "field1": "value1 UNION SELECT * FROM information_schema.tables --",
                "field2": "2 UNION SELECT * FROM information_schema.tables --",
                "field3": "{'field4': 'value2'} UNION SELECT * FROM information_schema.tables --",
            },
        },
        {
            "code": "???",
            "description": "unsafe bodies",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {
                "field1": "value1 SELECT version() --",
                "field2": "2 SELECT version() --",
                "field3": "{'field4': 'value2'} SELECT version() --",
            },
        },
        {
            "code": "???",
            "description": "unsafe bodies",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {
                "field1": "value1 select database_to_xml(true,true,'');",
                "field2": "2 select database_to_xml(true,true,'');",
                "field3": "{'field4': 'value2'} select database_to_xml(true,true,'');",
            },
        },
        {
            "code": "???",
            "description": "unsafe bodies",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {
                "field1": "value1 UNION SELECT * FROM information_schema.tables --",
                "field2": "2 UNION SELECT * FROM information_schema.tables --",
                "field3": "{'field4': 'value2'} UNION SELECT * FROM information_schema.tables --",
            },
        },
    ]
    assert batch == expected_batch


def test_generate_batch_body_and_unsafe_data_bodies():
    batch = generate_batch(
        "post",
        url,
        headers={"key1": "value1"},
        data=body,
        unsafe_bodies=True,
    )

    expected_batch = [
        {
            "code": "201",
            "description": "good",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "data": {"field1": "value1", "field2": 2, "field3": {"field4": "value2"}},
        },
        {
            "code": "400",
            "description": "invalid",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/aaaaaaaaaaaaaaaaaaaaa/1b",
            "data": {"field1": "value1", "field2": 2, "field3": {"field4": "value2"}},
        },
        {
            "code": "400",
            "description": "invalid",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/999aaa",
            "data": {"field1": "value1", "field2": 2, "field3": {"field4": "value2"}},
        },
        {
            "code": "400",
            "description": "invalid",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/aaaaaaaaaaaaaaaaaaaaa/999aaa",
            "data": {"field1": "value1", "field2": 2, "field3": {"field4": "value2"}},
        },
        {
            "code": "400",
            "description": "invalid",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "data": {
                "field1": "aaaaaaaaaaaaaaa999",
                "field2": 2,
                "field3": {"field4": "value2"},
            },
        },
        {
            "code": "400",
            "description": "invalid",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "data": {"field1": "value1", "field2": 999, "field3": {"field4": "value2"}},
        },
        {
            "code": "400",
            "description": "invalid",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "data": {
                "field1": "value1",
                "field2": 2,
                "field3": {"field4": "aaaaaaaaaaaaaaa999"},
            },
        },
        {
            "code": "400",
            "description": "invalid",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "data": {
                "field1": "aaaaaaaaaaaaaaa999",
                "field2": 999,
                "field3": {"field4": "aaaaaaaaaaaaaaa999"},
            },
        },
        {
            "code": "401",
            "description": "not auth",
            "method": "post",
            "headers": {"key1": "aaaaa0"},
            "url": "https://httpbin.org/houseId/1b",
            "data": {"field1": "value1", "field2": 2, "field3": {"field4": "value2"}},
        },
        {
            "code": "404",
            "description": "not found",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/aaaaaaa/1b",
            "data": {"field1": "value1", "field2": 2, "field3": {"field4": "value2"}},
        },
        {
            "code": "404",
            "description": "not found",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/0a",
            "data": {"field1": "value1", "field2": 2, "field3": {"field4": "value2"}},
        },
        {
            "code": "404",
            "description": "not found",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/aaaaaaa/0a",
            "data": {"field1": "value1", "field2": 2, "field3": {"field4": "value2"}},
        },
        {
            "code": "404",
            "description": "not found",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "data": {"field1": "aaaaa0", "field2": 2, "field3": {"field4": "value2"}},
        },
        {
            "code": "404",
            "description": "not found",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "data": {"field1": "value1", "field2": 0, "field3": {"field4": "value2"}},
        },
        {
            "code": "404",
            "description": "not found",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "data": {"field1": "value1", "field2": 2, "field3": {"field4": "aaaaa0"}},
        },
        {
            "code": "404",
            "description": "not found",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "data": {"field1": "aaaaa0", "field2": 0, "field3": {"field4": "aaaaa0"}},
        },
        {
            "code": "???",
            "description": "unsafe bodies",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "data": {
                "field1": "value1  '--",
                "field2": "2  '--",
                "field3": "{'field4': 'value2'}  '--",
            },
        },
        {
            "code": "???",
            "description": "unsafe bodies",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "data": {
                "field1": "value1 '+OR+1=1--",
                "field2": "2 '+OR+1=1--",
                "field3": "{'field4': 'value2'} '+OR+1=1--",
            },
        },
        {
            "code": "???",
            "description": "unsafe bodies",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "data": {
                "field1": "value1 SELECT version() --",
                "field2": "2 SELECT version() --",
                "field3": "{'field4': 'value2'} SELECT version() --",
            },
        },
        {
            "code": "???",
            "description": "unsafe bodies",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "data": {
                "field1": "value1  '--",
                "field2": "2  '--",
                "field3": "{'field4': 'value2'}  '--",
            },
        },
        {
            "code": "???",
            "description": "unsafe bodies",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "data": {
                "field1": "value1 '+OR+1=1--",
                "field2": "2 '+OR+1=1--",
                "field3": "{'field4': 'value2'} '+OR+1=1--",
            },
        },
        {
            "code": "???",
            "description": "unsafe bodies",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "data": {
                "field1": "value1 select database_to_xml(true,true,'');",
                "field2": "2 select database_to_xml(true,true,'');",
                "field3": "{'field4': 'value2'} select database_to_xml(true,true,'');",
            },
        },
        {
            "code": "???",
            "description": "unsafe bodies",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "data": {
                "field1": "value1  '--",
                "field2": "2  '--",
                "field3": "{'field4': 'value2'}  '--",
            },
        },
        {
            "code": "???",
            "description": "unsafe bodies",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "data": {
                "field1": "value1 '+OR+1=1--",
                "field2": "2 '+OR+1=1--",
                "field3": "{'field4': 'value2'} '+OR+1=1--",
            },
        },
        {
            "code": "???",
            "description": "unsafe bodies",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "data": {
                "field1": "value1 UNION SELECT * FROM information_schema.tables --",
                "field2": "2 UNION SELECT * FROM information_schema.tables --",
                "field3": "{'field4': 'value2'} UNION SELECT * FROM information_schema.tables --",
            },
        },
        {
            "code": "???",
            "description": "unsafe bodies",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "data": {
                "field1": "value1  '--",
                "field2": "2  '--",
                "field3": "{'field4': 'value2'}  '--",
            },
        },
        {
            "code": "???",
            "description": "unsafe bodies",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "data": {
                "field1": "value1 ' and substr(version(),1,10) = 'PostgreSQL' and '1  -> OK",
                "field2": "2 ' and substr(version(),1,10) = 'PostgreSQL' and '1  -> OK",
                "field3": "{'field4': 'value2'} ' and substr(version(),1,10) = 'PostgreSQL' and '1  -> OK",
            },
        },
        {
            "code": "???",
            "description": "unsafe bodies",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "data": {
                "field1": "value1 SELECT version() --",
                "field2": "2 SELECT version() --",
                "field3": "{'field4': 'value2'} SELECT version() --",
            },
        },
        {
            "code": "???",
            "description": "unsafe bodies",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "data": {
                "field1": "value1  '--",
                "field2": "2  '--",
                "field3": "{'field4': 'value2'}  '--",
            },
        },
        {
            "code": "???",
            "description": "unsafe bodies",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "data": {
                "field1": "value1 ' and substr(version(),1,10) = 'PostgreSQL' and '1  -> OK",
                "field2": "2 ' and substr(version(),1,10) = 'PostgreSQL' and '1  -> OK",
                "field3": "{'field4': 'value2'} ' and substr(version(),1,10) = 'PostgreSQL' and '1  -> OK",
            },
        },
        {
            "code": "???",
            "description": "unsafe bodies",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "data": {
                "field1": "value1 select database_to_xml(true,true,'');",
                "field2": "2 select database_to_xml(true,true,'');",
                "field3": "{'field4': 'value2'} select database_to_xml(true,true,'');",
            },
        },
        {
            "code": "???",
            "description": "unsafe bodies",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "data": {
                "field1": "value1  '--",
                "field2": "2  '--",
                "field3": "{'field4': 'value2'}  '--",
            },
        },
        {
            "code": "???",
            "description": "unsafe bodies",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "data": {
                "field1": "value1 ' and substr(version(),1,10) = 'PostgreSQL' and '1  -> OK",
                "field2": "2 ' and substr(version(),1,10) = 'PostgreSQL' and '1  -> OK",
                "field3": "{'field4': 'value2'} ' and substr(version(),1,10) = 'PostgreSQL' and '1  -> OK",
            },
        },
        {
            "code": "???",
            "description": "unsafe bodies",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "data": {
                "field1": "value1 UNION SELECT * FROM information_schema.tables --",
                "field2": "2 UNION SELECT * FROM information_schema.tables --",
                "field3": "{'field4': 'value2'} UNION SELECT * FROM information_schema.tables --",
            },
        },
        {
            "code": "???",
            "description": "unsafe bodies",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "data": {
                "field1": "value1  '--",
                "field2": "2  '--",
                "field3": "{'field4': 'value2'}  '--",
            },
        },
        {
            "code": "???",
            "description": "unsafe bodies",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "data": {
                "field1": "value1 SELECT version() --",
                "field2": "2 SELECT version() --",
                "field3": "{'field4': 'value2'} SELECT version() --",
            },
        },
        {
            "code": "???",
            "description": "unsafe bodies",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "data": {
                "field1": "value1 select database_to_xml(true,true,'');",
                "field2": "2 select database_to_xml(true,true,'');",
                "field3": "{'field4': 'value2'} select database_to_xml(true,true,'');",
            },
        },
        {
            "code": "???",
            "description": "unsafe bodies",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "data": {
                "field1": "value1  '--",
                "field2": "2  '--",
                "field3": "{'field4': 'value2'}  '--",
            },
        },
        {
            "code": "???",
            "description": "unsafe bodies",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "data": {
                "field1": "value1 SELECT version() --",
                "field2": "2 SELECT version() --",
                "field3": "{'field4': 'value2'} SELECT version() --",
            },
        },
        {
            "code": "???",
            "description": "unsafe bodies",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "data": {
                "field1": "value1 UNION SELECT * FROM information_schema.tables --",
                "field2": "2 UNION SELECT * FROM information_schema.tables --",
                "field3": "{'field4': 'value2'} UNION SELECT * FROM information_schema.tables --",
            },
        },
        {
            "code": "???",
            "description": "unsafe bodies",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "data": {
                "field1": "value1  '--",
                "field2": "2  '--",
                "field3": "{'field4': 'value2'}  '--",
            },
        },
        {
            "code": "???",
            "description": "unsafe bodies",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "data": {
                "field1": "value1 select database_to_xml(true,true,'');",
                "field2": "2 select database_to_xml(true,true,'');",
                "field3": "{'field4': 'value2'} select database_to_xml(true,true,'');",
            },
        },
        {
            "code": "???",
            "description": "unsafe bodies",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "data": {
                "field1": "value1 UNION SELECT * FROM information_schema.tables --",
                "field2": "2 UNION SELECT * FROM information_schema.tables --",
                "field3": "{'field4': 'value2'} UNION SELECT * FROM information_schema.tables --",
            },
        },
        {
            "code": "???",
            "description": "unsafe bodies",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "data": {
                "field1": "value1 '+OR+1=1--",
                "field2": "2 '+OR+1=1--",
                "field3": "{'field4': 'value2'} '+OR+1=1--",
            },
        },
        {
            "code": "???",
            "description": "unsafe bodies",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "data": {
                "field1": "value1 SELECT version() --",
                "field2": "2 SELECT version() --",
                "field3": "{'field4': 'value2'} SELECT version() --",
            },
        },
        {
            "code": "???",
            "description": "unsafe bodies",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "data": {
                "field1": "value1 select database_to_xml(true,true,'');",
                "field2": "2 select database_to_xml(true,true,'');",
                "field3": "{'field4': 'value2'} select database_to_xml(true,true,'');",
            },
        },
        {
            "code": "???",
            "description": "unsafe bodies",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "data": {
                "field1": "value1 '+OR+1=1--",
                "field2": "2 '+OR+1=1--",
                "field3": "{'field4': 'value2'} '+OR+1=1--",
            },
        },
        {
            "code": "???",
            "description": "unsafe bodies",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "data": {
                "field1": "value1 SELECT version() --",
                "field2": "2 SELECT version() --",
                "field3": "{'field4': 'value2'} SELECT version() --",
            },
        },
        {
            "code": "???",
            "description": "unsafe bodies",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "data": {
                "field1": "value1 UNION SELECT * FROM information_schema.tables --",
                "field2": "2 UNION SELECT * FROM information_schema.tables --",
                "field3": "{'field4': 'value2'} UNION SELECT * FROM information_schema.tables --",
            },
        },
        {
            "code": "???",
            "description": "unsafe bodies",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "data": {
                "field1": "value1 '+OR+1=1--",
                "field2": "2 '+OR+1=1--",
                "field3": "{'field4': 'value2'} '+OR+1=1--",
            },
        },
        {
            "code": "???",
            "description": "unsafe bodies",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "data": {
                "field1": "value1 select database_to_xml(true,true,'');",
                "field2": "2 select database_to_xml(true,true,'');",
                "field3": "{'field4': 'value2'} select database_to_xml(true,true,'');",
            },
        },
        {
            "code": "???",
            "description": "unsafe bodies",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "data": {
                "field1": "value1 UNION SELECT * FROM information_schema.tables --",
                "field2": "2 UNION SELECT * FROM information_schema.tables --",
                "field3": "{'field4': 'value2'} UNION SELECT * FROM information_schema.tables --",
            },
        },
        {
            "code": "???",
            "description": "unsafe bodies",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "data": {
                "field1": "value1 ' and substr(version(),1,10) = 'PostgreSQL' and '1  -> OK",
                "field2": "2 ' and substr(version(),1,10) = 'PostgreSQL' and '1  -> OK",
                "field3": "{'field4': 'value2'} ' and substr(version(),1,10) = 'PostgreSQL' and '1  -> OK",
            },
        },
        {
            "code": "???",
            "description": "unsafe bodies",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "data": {
                "field1": "value1 SELECT version() --",
                "field2": "2 SELECT version() --",
                "field3": "{'field4': 'value2'} SELECT version() --",
            },
        },
        {
            "code": "???",
            "description": "unsafe bodies",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "data": {
                "field1": "value1 select database_to_xml(true,true,'');",
                "field2": "2 select database_to_xml(true,true,'');",
                "field3": "{'field4': 'value2'} select database_to_xml(true,true,'');",
            },
        },
        {
            "code": "???",
            "description": "unsafe bodies",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "data": {
                "field1": "value1 ' and substr(version(),1,10) = 'PostgreSQL' and '1  -> OK",
                "field2": "2 ' and substr(version(),1,10) = 'PostgreSQL' and '1  -> OK",
                "field3": "{'field4': 'value2'} ' and substr(version(),1,10) = 'PostgreSQL' and '1  -> OK",
            },
        },
        {
            "code": "???",
            "description": "unsafe bodies",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "data": {
                "field1": "value1 SELECT version() --",
                "field2": "2 SELECT version() --",
                "field3": "{'field4': 'value2'} SELECT version() --",
            },
        },
        {
            "code": "???",
            "description": "unsafe bodies",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "data": {
                "field1": "value1 UNION SELECT * FROM information_schema.tables --",
                "field2": "2 UNION SELECT * FROM information_schema.tables --",
                "field3": "{'field4': 'value2'} UNION SELECT * FROM information_schema.tables --",
            },
        },
        {
            "code": "???",
            "description": "unsafe bodies",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "data": {
                "field1": "value1 ' and substr(version(),1,10) = 'PostgreSQL' and '1  -> OK",
                "field2": "2 ' and substr(version(),1,10) = 'PostgreSQL' and '1  -> OK",
                "field3": "{'field4': 'value2'} ' and substr(version(),1,10) = 'PostgreSQL' and '1  -> OK",
            },
        },
        {
            "code": "???",
            "description": "unsafe bodies",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "data": {
                "field1": "value1 select database_to_xml(true,true,'');",
                "field2": "2 select database_to_xml(true,true,'');",
                "field3": "{'field4': 'value2'} select database_to_xml(true,true,'');",
            },
        },
        {
            "code": "???",
            "description": "unsafe bodies",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "data": {
                "field1": "value1 UNION SELECT * FROM information_schema.tables --",
                "field2": "2 UNION SELECT * FROM information_schema.tables --",
                "field3": "{'field4': 'value2'} UNION SELECT * FROM information_schema.tables --",
            },
        },
        {
            "code": "???",
            "description": "unsafe bodies",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "data": {
                "field1": "value1 SELECT version() --",
                "field2": "2 SELECT version() --",
                "field3": "{'field4': 'value2'} SELECT version() --",
            },
        },
        {
            "code": "???",
            "description": "unsafe bodies",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "data": {
                "field1": "value1 select database_to_xml(true,true,'');",
                "field2": "2 select database_to_xml(true,true,'');",
                "field3": "{'field4': 'value2'} select database_to_xml(true,true,'');",
            },
        },
        {
            "code": "???",
            "description": "unsafe bodies",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "data": {
                "field1": "value1 UNION SELECT * FROM information_schema.tables --",
                "field2": "2 UNION SELECT * FROM information_schema.tables --",
                "field3": "{'field4': 'value2'} UNION SELECT * FROM information_schema.tables --",
            },
        },
    ]
    assert batch == expected_batch


def test_generate_batch_body_corrupt_keys():
    batch = generate_batch(
        "post", url_semi, headers={"key1": "value1"}, json=body, corrupt_keys=True
    )

    expected_batch = [
        {
            "code": "201",
            "description": "good",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {"field1": "value1", "field2": 2, "field3": {"field4": "value2"}},
        },
        {
            "code": "400",
            "description": "invalid",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/aaaaaaaaaaaaaaaaaaaaa/1b",
            "json": {"field1": "value1", "field2": 2, "field3": {"field4": "value2"}},
        },
        {
            "code": "400",
            "description": "invalid",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/999aaa",
            "json": {"field1": "value1", "field2": 2, "field3": {"field4": "value2"}},
        },
        {
            "code": "400",
            "description": "invalid",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/aaaaaaaaaaaaaaaaaaaaa/999aaa",
            "json": {"field1": "value1", "field2": 2, "field3": {"field4": "value2"}},
        },
        {
            "code": "400",
            "description": "invalid",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {
                "field1": "aaaaaaaaaaaaaaa999",
                "field2": 2,
                "field3": {"field4": "value2"},
            },
        },
        {
            "code": "400",
            "description": "invalid",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {"aaaaa1": "value1", "field2": 2, "field3": {"field4": "value2"}},
        },
        {
            "code": "400",
            "description": "invalid",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {"field1": "value1", "field2": 999, "field3": {"field4": "value2"}},
        },
        {
            "code": "400",
            "description": "invalid",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {"field1": "value1", "aaaaa2": 2, "field3": {"field4": "value2"}},
        },
        {
            "code": "400",
            "description": "invalid",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {
                "field1": "value1",
                "field2": 2,
                "field3": {"field4": "aaaaaaaaaaaaaaa999"},
            },
        },
        {
            "code": "400",
            "description": "invalid",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {"field1": "value1", "field2": 2, "aaaaa3": {"aaaaa4": "value2"}},
        },
        {
            "code": "400",
            "description": "invalid",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {
                "field1": "aaaaaaaaaaaaaaa999",
                "field2": 999,
                "field3": {"field4": "aaaaaaaaaaaaaaa999"},
            },
        },
        {
            "code": "401",
            "description": "not auth",
            "method": "post",
            "headers": {"key1": "aaaaa0"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {"field1": "value1", "field2": 2, "field3": {"field4": "value2"}},
        },
        {
            "code": "404",
            "description": "not found",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/aaaaaaa/1b",
            "json": {"field1": "value1", "field2": 2, "field3": {"field4": "value2"}},
        },
        {
            "code": "404",
            "description": "not found",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/0a",
            "json": {"field1": "value1", "field2": 2, "field3": {"field4": "value2"}},
        },
        {
            "code": "404",
            "description": "not found",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/aaaaaaa/0a",
            "json": {"field1": "value1", "field2": 2, "field3": {"field4": "value2"}},
        },
        {
            "code": "404",
            "description": "not found",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {"field1": "aaaaa0", "field2": 2, "field3": {"field4": "value2"}},
        },
        {
            "code": "404",
            "description": "not found",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {"aaaaa1": "value1", "field2": 2, "field3": {"field4": "value2"}},
        },
        {
            "code": "404",
            "description": "not found",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {"field1": "value1", "field2": 0, "field3": {"field4": "value2"}},
        },
        {
            "code": "404",
            "description": "not found",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {"field1": "value1", "aaaaa2": 2, "field3": {"field4": "value2"}},
        },
        {
            "code": "404",
            "description": "not found",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {"field1": "value1", "field2": 2, "field3": {"field4": "aaaaa0"}},
        },
        {
            "code": "404",
            "description": "not found",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {"field1": "value1", "field2": 2, "aaaaa3": {"aaaaa4": "value2"}},
        },
        {
            "code": "404",
            "description": "not found",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {"field1": "aaaaa0", "field2": 0, "field3": {"field4": "aaaaa0"}},
        },
    ]
    assert batch == expected_batch


def test_generate_batch_data_corrupt_keys():
    batch = generate_batch(
        "post", url_semi, headers={"key1": "value1"}, json=body, corrupt_keys=True
    )

    expected_batch = [
        {
            "code": "201",
            "description": "good",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {"field1": "value1", "field2": 2, "field3": {"field4": "value2"}},
        },
        {
            "code": "400",
            "description": "invalid",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/aaaaaaaaaaaaaaaaaaaaa/1b",
            "json": {"field1": "value1", "field2": 2, "field3": {"field4": "value2"}},
        },
        {
            "code": "400",
            "description": "invalid",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/999aaa",
            "json": {"field1": "value1", "field2": 2, "field3": {"field4": "value2"}},
        },
        {
            "code": "400",
            "description": "invalid",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/aaaaaaaaaaaaaaaaaaaaa/999aaa",
            "json": {"field1": "value1", "field2": 2, "field3": {"field4": "value2"}},
        },
        {
            "code": "400",
            "description": "invalid",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {
                "field1": "aaaaaaaaaaaaaaa999",
                "field2": 2,
                "field3": {"field4": "value2"},
            },
        },
        {
            "code": "400",
            "description": "invalid",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {"aaaaa1": "value1", "field2": 2, "field3": {"field4": "value2"}},
        },
        {
            "code": "400",
            "description": "invalid",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {"field1": "value1", "field2": 999, "field3": {"field4": "value2"}},
        },
        {
            "code": "400",
            "description": "invalid",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {"field1": "value1", "aaaaa2": 2, "field3": {"field4": "value2"}},
        },
        {
            "code": "400",
            "description": "invalid",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {
                "field1": "value1",
                "field2": 2,
                "field3": {"field4": "aaaaaaaaaaaaaaa999"},
            },
        },
        {
            "code": "400",
            "description": "invalid",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {"field1": "value1", "field2": 2, "aaaaa3": {"aaaaa4": "value2"}},
        },
        {
            "code": "400",
            "description": "invalid",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {
                "field1": "aaaaaaaaaaaaaaa999",
                "field2": 999,
                "field3": {"field4": "aaaaaaaaaaaaaaa999"},
            },
        },
        {
            "code": "401",
            "description": "not auth",
            "method": "post",
            "headers": {"key1": "aaaaa0"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {"field1": "value1", "field2": 2, "field3": {"field4": "value2"}},
        },
        {
            "code": "404",
            "description": "not found",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/aaaaaaa/1b",
            "json": {"field1": "value1", "field2": 2, "field3": {"field4": "value2"}},
        },
        {
            "code": "404",
            "description": "not found",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/0a",
            "json": {"field1": "value1", "field2": 2, "field3": {"field4": "value2"}},
        },
        {
            "code": "404",
            "description": "not found",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/aaaaaaa/0a",
            "json": {"field1": "value1", "field2": 2, "field3": {"field4": "value2"}},
        },
        {
            "code": "404",
            "description": "not found",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {"field1": "aaaaa0", "field2": 2, "field3": {"field4": "value2"}},
        },
        {
            "code": "404",
            "description": "not found",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {"aaaaa1": "value1", "field2": 2, "field3": {"field4": "value2"}},
        },
        {
            "code": "404",
            "description": "not found",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {"field1": "value1", "field2": 0, "field3": {"field4": "value2"}},
        },
        {
            "code": "404",
            "description": "not found",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {"field1": "value1", "aaaaa2": 2, "field3": {"field4": "value2"}},
        },
        {
            "code": "404",
            "description": "not found",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {"field1": "value1", "field2": 2, "field3": {"field4": "aaaaa0"}},
        },
        {
            "code": "404",
            "description": "not found",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {"field1": "value1", "field2": 2, "aaaaa3": {"aaaaa4": "value2"}},
        },
        {
            "code": "404",
            "description": "not found",
            "method": "post",
            "headers": {"key1": "value1"},
            "url": "https://httpbin.org/houseId/1b",
            "json": {"field1": "aaaaa0", "field2": 0, "field3": {"field4": "aaaaa0"}},
        },
    ]
    assert batch == expected_batch
